{% extends "base.html" %}

{% block title %}{{ post.title }} - 优雅博客{% endblock %}
{% block description %}{{ post.excerpt or post.content[:150] }}{% endblock %}

{% block content %}
<article class="post-detail">
    <div class="container">
        <!-- 文章头部 -->
        <header class="post-header">
            <div class="post-meta">
                <span class="post-category">
                    <a href="{{ url_for('category', slug=post.category.slug) }}">{{ post.category.name }}</a>
                </span>
                <span class="post-date">{{ post.created_at.strftime('%Y年%m月%d日') }}</span>
                <span class="post-author">作者：{{ post.author.username }}</span>
                <span class="post-views">{{ post.view_count }} 次阅读</span>
            </div>
            
            <h1 class="post-title">{{ post.title }}</h1>
            
            {% if post.excerpt %}
            <div class="post-excerpt">
                <p>{{ post.excerpt }}</p>
            </div>
            {% endif %}
        </header>

        <!-- 特色图片 -->
        {% if post.featured_image %}
        <div class="post-featured-image">
            <img src="{{ url_for('static', filename='uploads/' + post.featured_image) }}" alt="{{ post.title }}">
        </div>
        {% endif %}

        <!-- 文章内容 -->
        <div class="post-content">
            <div class="content-wrapper">
                {{ post.content | safe }}
            </div>
        </div>

        <!-- 文章标签 -->
        {% if post.tags %}
        <div class="post-tags">
            <h3>标签：</h3>
            <div class="tags-list">
                {% for tag in post.tags %}
                <span class="tag">{{ tag.name }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- 文章信息 -->
        <footer class="post-footer">
            <div class="post-info">
                <p>最后更新：{{ post.updated_at.strftime('%Y年%m月%d日 %H:%M') }}</p>
            </div>
            
            <div class="post-actions">
                <button class="btn btn-secondary share-btn" onclick="sharePost()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    分享文章
                </button>
            </div>
        </footer>
    </div>
</article>

<!-- 相关文章 -->
{% if related_posts %}
<section class="related-posts">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">相关文章</h2>
            <p class="section-subtitle">您可能还对这些文章感兴趣</p>
        </div>
        
        <div class="related-grid">
            {% for related_post in related_posts %}
            <article class="related-card">
                {% if related_post.featured_image %}
                <div class="related-image">
                    <a href="{{ url_for('post', slug=related_post.slug) }}">
                        <img src="{{ url_for('static', filename='uploads/' + related_post.featured_image) }}" alt="{{ related_post.title }}">
                    </a>
                </div>
                {% endif %}
                <div class="related-content">
                    <h3 class="related-title">
                        <a href="{{ url_for('post', slug=related_post.slug) }}">{{ related_post.title }}</a>
                    </h3>
                    <div class="related-meta">
                        <span class="related-date">{{ related_post.created_at.strftime('%Y年%m月%d日') }}</span>
                        <span class="related-category">{{ related_post.category.name }}</span>
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- 导航 -->
<nav class="post-navigation">
    <div class="container">
        <div class="nav-links">
            <a href="{{ url_for('index') }}" class="nav-link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m15 18-6-6 6-6"/>
                </svg>
                返回首页
            </a>
            <a href="{{ url_for('category', slug=post.category.slug) }}" class="nav-link">
                浏览 {{ post.category.name }}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m9 18 6-6-6-6"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
{% endblock %}

{% block extra_js %}
<script>
function sharePost() {
    if (navigator.share) {
        navigator.share({
            title: '{{ post.title }}',
            text: '{{ post.excerpt or post.content[:100] }}',
            url: window.location.href
        });
    } else {
        // 复制链接到剪贴板
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('链接已复制到剪贴板！');
        });
    }
}
</script>
{% endblock %}
